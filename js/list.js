"use strict";$(function(){$("#site-nav").load("site-nav.html"),$("#header .public_header").load("public_header.html"),$(".public_tuijiebook").load("public_tuijiebook.html"),$("#footer").load("footer.html");var d=1,p=void 0,u=void 0;function m(o){var c="",l="",r="";new Promise(function(s){$.ajax({type:"get",url:"../api/list.php",data:{mes:o.name,page:o.ipage,order:o.order},success:function(a){s(a)}})}).then(function(a){var s=JSON.parse(a);u=s.total,p=Math.ceil(u/10),s.group.map(function(a){c+='<div class="single-bar" data-id="'+a.id+'">\n                            <ul>\n                                <li class="s-book-img img130" data-id="'+a.id+'">\n                                    <a href="javascript:void(0)">\n                                        <img src="'+a.image+'" alt="">\n                                    </a>\n                                </li>\n                                <li class="s-book-info">\n                                    <div class="s-book-name">\n                                        <a href="">'+a.name+'</a>\n                                    </div>\n                                    <div class="authors">\n                                        '+a.authors+'\n                                        <a href="">'+a.press+"</a>\n                                         "+a.time+'\n                                    </div>\n                                    <div class="summary">\n                                        　　'+a.summary+'\n                                    </div>\n                                </li>\n                                <li class="legend">\n                                    <div class="price">\n                                        <span class="new-price">'+a.new_price+'</span>\n                                    </div>\n                                    <div class="price">\n                                        <span class="old-price">'+a.old_price+'</span>\n                                    </div>\n                                    <div class="price">\n                                        <span class="discount">'+a.discount+'折</span>\n                                    </div>\n                                    <a href="javascript:void(0)" class="btn-sbuy"></a>\n                                    <a href="javascript:void(0)" class="btn-sadd"></a>\n                                </li>\n                            </ul>\n                        </div>'}),s.all.map(function(a,s){r+='<li class="selected">\n                                    <div class="tbook-img img100">\n                                        <a href="">\n                                            <img src="'+a.image+'" alt="">\n                                        </a>\n                                    </div>\n                                    <div class="tbook-info">\n                                        <div class="tbook-name">\n                                            <a href="">'+a.name+'</a>\n                                        </div>\n                                        <div class="tbook-author">'+a.authors+'</div>\n                                        <div class="price">\n                                            <p>\n                                                <span class="old-price">'+a.new_price+'</span>\n                                                <span class="new-price">'+a.old_price+"</span>\n                                            </p>\n                                        </div>\n                                    </div>\n                                </li>"});for(var e=0;e<p;e++)l+='<a href="javascript:void(0)">'+(e+1)+"</a>";$(".pages .pagenum").html(l),$("#book-list .book-single").html(c),$(".ks-wxtj-content").css("width",860*Math.ceil(u/4)+"px"),$(".ks-wxtj-content").html(r);var n=0,t=$(".scroller").outerWidth(),i=parseInt($(".ks-wxtj-content").outerWidth()/t);$(".prev").click(function(){--n<0&&(n=i-1,$(".ks-wxtj-content").css("left",-i*t)),$(".ks-wxtj-content").animate({left:-n*t+"px"})}),$(".next").click(function(){i-1<++n&&(n=0,$(".ks-wxtj-content").css("left",t)),$(".ks-wxtj-content").animate({left:-n*t+"px"})}),$(".single-bar").on("click",".btn-sbuy",function(){var e=this;getCookie("username")?new Promise(function(s){$.ajax({url:"../api/cart.php",type:"post",data:{mes:"insert",goods_id:$(e).parent().parent().parent().data("id"),uid:getCookie("uid")},success:function(a){s(a)}})}).then(function(a){if("exist"==a)confirm("你已经添加该商品请到购物车查看(按确定跳转到购物车)")&&(location.href="cart.html");else if("yes"==a){$(".ks-overlay").css({display:"block",left:$(e).offset().left-365+"px",top:$(e).offset().top+"px"});var n=0;new Promise(function(s){$.ajax({url:"../api/cart.php",type:"get",data:{mes:"selid",uid:getCookie("uid")},dataType:"json",success:function(a){s(a)}})}).then(function(a){var e=0;a.forEach(function(a){n+=a.number-0;var s=a.number;$("#cartnum").html(n),new Promise(function(s){$.ajax({url:"../api/list.php",type:"get",data:{id:a.goods_id,mes:"seleid"},dataType:"json",success:function(a){s(a)}})}).then(function(a){e+=a[0].new_price*s,$(".ts-price").html(e)})})}),$(".ts-long-btn").click(function(){location.href="cart.html"}),$(".ts-long-btn1").click(function(){$(".ks-overlay").css("display","none")}),$(".ks-ext-close-x").click(function(){$(".ks-overlay").css("display","none")})}}):(alert("您还没登陆，请先登录"),localStorage.url=location.href,location.href="login.html")}),$(".pages .pagenum").children().eq(d-1).addClass("page-cur"),1==d?$(".pages .stat-page").addClass("stop"):0!=d&&$(".pages .stat-page").removeClass("stop"),d==p?$(".pages .page-next").addClass("stop"):d!=p&&$(".pages .page-next").removeClass("stop"),$(".pages .page-next").unbind("click"),$(".pages .page-next").click(function(){d!=p&&(console.log(d),d++,console.log(d),m({ipage:d,name:o.name}))}),$(".pages .stat-page").unbind("click"),$(".pages .stat-page").click(function(){1!=d&&m({ipage:--d,name:o.name})}),$(".pagenum").on("click","a",function(){console.log(d),d=$(this).html(),console.log(d),m({ipage:d,name:o.name})})})}m({ipage:d,name:"init"});$(".rank_r").on("click","a",function(){for(var a=1;a<=5;a++)$(".rank_r a").eq(a).removeClass().addClass($(".rank_r a").eq(a).data("name"));switch($(this).addClass($(this).data("name")+"-current").removeClass($(this).data("name")),$(this).index()){case 3:console.log($(this).attr("isok")),"true"==$(this).attr("isok")?(m({ipage:d,name:"order",order:"asc"}),$(this).removeClass().addClass($(this).data("name")+"-current"),$(this).attr("isok","false")):(m({ipage:d,name:"order",order:"desc"}),$(this).removeClass().addClass($(this).data("name")+"-current1"),$(this).attr("isok","true"));break;case 4:"true"==$(this).attr("isok")?(m({ipage:d,name:"discount",order:"asc"}),$(this).removeClass().addClass($(this).data("name")+"-current"),$(this).attr("isok","false")):(m({ipage:d,name:"discount",order:"desc"}),$(this).removeClass().addClass($(this).data("name")+"-current1"),$(this).attr("isok","true"))}}),$(".book-single").on("click",".s-book-img",function(){var a=$(this).data("id");location.href="detail.html?"+a})});