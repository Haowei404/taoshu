"use strict";$(function(){var d=0,c=1,o=0;function t(){var a=[];return $(".table tbody tr td input").each(function(t,e){$(e).prop("checked")&&a.push(t)}),a}!function i(){$.ajax({url:"../api/admin.php",type:"get",data:{mes:"goodinit",now:c},success:function(t){var e,a=JSON.parse(t),n="";d=a.total,o=Math.ceil(d/10),e=a.group.map(function(t){return'<tr>\n                                <td><input type="checkbox" /></td>\n                                <td>'+t.id+"</td>\n                                <td>"+t.name+"</td>\n                                <td>"+t.image+"</td>\n                                <td>"+t.authors+"</td>\n                                <td>"+t.press+"</td>\n                                <td>"+t.time+"</td>\n                                <td>"+t.summary+"</td>\n                                <td>"+t.new_price+"</td>\n                                <td>"+t.old_price+"</td>\n                                <td>"+t.discount+"</td>\n                                <td>"+t.stock+'</td>\n                                <td style="width:100px">\n                                    <button type="submit" class="btn btn-success">修改并保存</button>\n                                    <button type="submit" class="btn btn-danger">删除</button>\n                                    <button type="submit" class="btn btn-info">Edit</button>\n                                </td>\n                            </tr>'}).join(""),$(".table tbody").html(e);for(var l=0;l<o;l++)n+='<a tabindex="0" class="fg-button ui-button ui-state-default">'+(l+1)+"</a>";$("#pageall").html(n),1==c?($("#DataTables_Table_0_previous").addClass("ui-state-disabled"),$("#DataTables_Table_0_first").addClass("ui-state-disabled")):($("#DataTables_Table_0_previous").removeClass("ui-state-disabled"),$("#DataTables_Table_0_first").removeClass("ui-state-disabled")),c==o?($("#DataTables_Table_0_next").addClass("ui-state-disabled"),$("#DataTables_Table_0_last").addClass("ui-state-disabled")):($("#DataTables_Table_0_next").removeClass("ui-state-disabled"),$("#DataTables_Table_0_last").removeClass("ui-state-disabled")),$("#DataTables_Table_0_next").unbind("click"),$("#DataTables_Table_0_next").click(function(){c!=o&&(c++,i())}),$("#DataTables_Table_0_previous").unbind("click"),$("#DataTables_Table_0_previous").click(function(){1!=c&&(c--,i())}),$("#pageall").on("click","a",function(){c=$(this).html(),i()}),$("#DataTables_Table_0_first").click(function(){c=1,i()}),$("#DataTables_Table_0_last").click(function(){c=o,i()}),$("#pageall a").removeClass("ui-state-disabled"),$("#pageall a").eq(c-1).addClass("ui-state-disabled")}})}(),$("#title-checkbox").click(function(){var a=$("#title-checkbox").prop("checked");$(".table tbody tr td input").each(function(t,e){$(e).prop("checked",a)})}),$(".table").on("click","tbody tr td input",function(){t().length==$(".table tbody tr td input").length?$("#title-checkbox").prop("checked",!0):$("#title-checkbox").prop("checked",!1)}),$("#delall").click(function(){confirm("你确定要删除所选行数吗")&&t().reverse().forEach(function(a){new Prommise(function(e){$.ajax({url:"../api/admin.php",type:"get",data:{mes:"gooddel",goodid:$(".table tr").eq(a+1).find("td").eq(1).html()},success:function(t){e(t)}})}).then(function(t){$(".table tr").eq(a+1).remove(),location.reload()})})}),$(".table tbody").on("click",".btn-danger",function(){var t=$(this).parent().parent().children().eq(1).html();confirm("确定要删除吗")&&($.ajax({type:"get",url:"../api/admin.php",data:{goodid:t,mes:"gooddel"},success:function(t){console.log(t)}}),$(this).parent().parent().remove())}),$(".table tbody").on("click",".btn-info",function(){var t=$(this).parent().parent().children().eq(1),e=$(this).parent().parent().children().eq(2),a=$(this).parent().parent().children().eq(3),n=$(this).parent().parent().children().eq(4),l=$(this).parent().parent().children().eq(5),i=$(this).parent().parent().children().eq(6),d=$(this).parent().parent().children().eq(7),c=$(this).parent().parent().children().eq(8),o=$(this).parent().parent().children().eq(9),s=$(this).parent().parent().children().eq(10),r=$(this).parent().parent().children().eq(11);e.attr("contenteditable",!0).focus(),a.attr("contenteditable",!0),n.attr("contenteditable",!0),l.attr("contenteditable",!0),i.attr("contenteditable",!0),d.attr("contenteditable",!0),c.attr("contenteditable",!0),o.attr("contenteditable",!0),s.attr("contenteditable",!0),r.attr("contenteditable",!0),console.log(t.html()),$(this).prev().prev().click(function(){console.log(t.html()),$.ajax({type:"get",url:"../api/admin.php",data:{goodid:t.html(),goodname:e.html(),picurl:a.html(),author:n.html(),press:l.html(),time:i.html(),intro:d.html(),new_price:c.html(),old_price:o.html(),discount:s.html(),stock:r.html(),mes:"goodupdate"},success:function(t){console.log(t),"yes"==t&&(alert("修改成功"),e.attr("contenteditable",!1),a.attr("contenteditable",!1),n.attr("contenteditable",!1),l.attr("contenteditable",!1),i.attr("contenteditable",!1),d.attr("contenteditable",!1),c.attr("contenteditable",!1),o.attr("contenteditable",!1),s.attr("contenteditable",!1),r.attr("contenteditable",!1))}})})})});