"use strict";$(function(){var i=1,s=0,l=0;!function n(){var d="",a="";new Promise(function(e){$.ajax({url:"../api/admin.php",type:"get",data:{mes:"orderinit",num:5,now:i},dataType:"json",success:function(t){e(t)}})}).then(function(t){s=t.total,t.group.forEach(function(t){var e=t.id,n=t.uid,a=t.goods_id,i=t.number,s=t.create_time;new Promise(function(e){$.ajax({url:"../api/list.php",type:"get",dataType:"json",data:{mes:"seleid",id:a},success:function(t){e(t)}})}).then(function(t){d+='<tr>\n                                    <td>\n                                        <input type="checkbox" style="margin-top:-3px;" />\n                                    </td>\n                                    <td>'+e+"</td>\n                                    <td >"+n+"</td>\n                                    <td>"+a+"</td>\n                                    <td>"+i+"</td>\n                                    <td>"+t[0].stock+"</td>\n                                    <td>"+t[0].name+"</td>\n                                    <td>"+s+'</td>\n                                    <td>\n                                        <button type="submit" class="btn btn-success">修改并保存</button>\n                                        <button type="submit" class="btn btn-danger">删除</button>\n                                        <button type="submit" class="btn btn-info">Edit</button>\n                                    </td>\n                                </tr>',$(".table tbody").html(d)})}),l=Math.ceil(s/5);for(var e=0;e<l;e++)a+='<a tabindex="0" class="fg-button ui-button ui-state-default">'+(e+1)+"</a>";$("#pageAll").html(a),$("#pageAll a").eq(i-1).addClass("ui-state-disabled").siblings().removeClass("ui-state-disabled"),1==i?($("#DataTables_Table_0_previous").addClass("ui-state-disabled"),$("#DataTables_Table_0_first").addClass("ui-state-disabled")):($("#DataTables_Table_0_previous").removeClass("ui-state-disabled"),$("#DataTables_Table_0_first").removeClass("ui-state-disabled")),i==l?($("#DataTables_Table_0_next").addClass("ui-state-disabled"),$("#DataTables_Table_0_last").addClass("ui-state-disabled")):($("#DataTables_Table_0_next").removeClass("ui-state-disabled"),$("#DataTables_Table_0_last").removeClass("ui-state-disabled")),$("#DataTables_Table_0_next").unbind("click"),$("#DataTables_Table_0_next").click(function(){i!=l&&(i++,n())}),$("#DataTables_Table_0_previous").unbind("click"),$("#DataTables_Table_0_previous").click(function(){1!=i&&(i--,n())}),$("#DataTables_Table_0_first").unbind("click"),$("#DataTables_Table_0_first").click(function(){i=1,n()}),$("#DataTables_Table_0_last").unbind("click"),$("#DataTables_Table_0_last").click(function(){i=l,n()}),$("#pageAll").on("click","a",function(){i=$(this).html(),n()})})}();var e=0;function t(){var n=[];return $("#orderinf tr input").each(function(t,e){1==$("#orderinf tr input").eq(t).prop("checked")&&n.push(t)}),n}$("#orderinf").on("click",".btn-info",function(){$(this).parent().parent().find("td").eq(4).attr("contenteditable",!0).focus(),e=$(this).parent().parent().find("td").eq(4).html()}),$("#orderinf").on("click",".btn-success",function(){var n=this,t=$(this).parent().parent().find("td").eq(5).html(),a=$(this).parent().parent().find("td").eq(4).html();if(t-0<a-0)alert("购买量不能超过库存"),$(this).parent().parent().find("td").eq(4).html(e);else if(a-0<1)alert("购买量不能少于一件"),$(this).parent().parent().find("td").eq(4).html(e);else if(1<=a-0&&a-0<=t){if(console.log(1),confirm("你确定要修改吗？"))new Promise(function(e){$.ajax({url:"../api/cart.php",type:"get",data:{mes:"update",num:a,uid:$(n).parent().parent().find("td").eq(2).html(),goods_id:$(n).parent().parent().find("td").eq(3).html()},success:function(t){e(t)}})}).then(function(t){$(n).parent().parent().find("td").eq(4).attr("contenteditable",!1)})}}),$("#orderinf").on("click",".btn-danger",function(){var n=this;confirm("你确定要删除这行吗")&&new Promise(function(e){$.ajax({url:"../api/cart.php",type:"get",data:{mes:"del",goods_id:$(n).parent().parent().find("td").eq(3).html(),uid:$(n).parent().parent().find("td").eq(2).html()},success:function(t){e(t)}})}).then(function(t){$(n).parent().parent().remove(),location.reload()})}),$("#title-checkbox").click(function(){var n=$("#title-checkbox").prop("checked");$("#orderinf tr input").each(function(t,e){$("#orderinf tr input").eq(t).prop("checked",n)})}),$("#orderinf").on("click","input",function(){t().length==$("#orderinf tr input").length?$("#title-checkbox").prop("checked",!0):$("#title-checkbox").prop("checked",!1)}),$("#delall").click(function(){confirm("你去定要删除选中行吗")&&t().reverse().forEach(function(n){new Promise(function(e){$.ajax({url:"../api/cart.php",type:"get",data:{mes:"del",goods_id:$("#orderinf tr").eq(n).find("td").eq(3).html(),uid:$("#orderinf tr").eq(n).find("td").eq(2).html()},success:function(t){e(t)}})}).then(function(t){$("#orderinf tr").eq(n).remove()})})})});